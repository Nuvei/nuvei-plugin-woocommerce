/*v1.121.0	 	rev #6d05d72, built on 2022-11-01 15:47:46*/
String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),a=1;a<arguments.length;a++){var o=arguments[a];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n},writable:!0,configurable:!0}),"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),a=1;a<arguments.length;a++){var o=arguments[a];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n}),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),a=n.length>>>0,o=arguments[1],r=0;r<a;r++)if(t=n[r],e.call(o,t,r,n))return t}),function(){function e(){null!=this.parentNode&&this.parentNode.removeChild(this)}for(var t=["DocumentType","Element","CharacterData"],n=0;n<t.length;n++){var a=t[n];window[a]&&!window[a].prototype.remove&&(window[a].prototype.remove=e)}}(),function(e){e.ulog=function(){"use strict";function o(e){return e?i[e]?i[e]:i[e]=n({name:e},o):o.debug?o:n(o)}o.ulog={version:"1.1.0"},o.enable=function(e){var t,n=(e||"").split(/[\s,]+/);for(t=0;t<n.length;t++)if(n[t]){e=n[t].replace(/\*/g,".*?");if(e[0]==="-")s.push(new RegExp("^"+e.substr(1)+"$"));else a.push(new RegExp("^"+e+"$"))}for(t in i)c(i[t])},o.enabled=function(e){var t;for(t=0;t<s.length;t++)if(s[t].test(e))return;for(t=0;t<a.length;t++)if(a[t].test(e))return true},o.disable=o.enable.bind(o,"");var t={ERROR:1,WARN:2,INFO:3,LOG:4,DEBUG:5,TRACE:6},r=Object.keys(t).map(function(e){return e.toLowerCase()}),i={},a=[],s=[];function n(n,a,o){n.NONE=0;for(var e in t)n[e]=t[e];Object.defineProperty(n,"level",{get:function(){return o!==undefined?o:a&&a.level},set:function(e){if(e===undefined&&a)o=undefined;else{var t=e&&(Number(e)!==Number(e)?n[e.toUpperCase()]:Number(e));if(t>=0&&t<=6)o=t}c(n);if(!a)for(mod in i)c(i[mod])}});c(n,a);n.dir=p("dir")||d;n.table=p("table")||d;n.time=p("time")||d;n.timeEnd=p("timeEnd")||d;n.assert=typeof window=="object"&&p("assert")||function(){var e=[].concat.apply([],arguments),t=e.shift();if(!t)n.error.apply(n,e)};return n}function c(e){var t=Math.max(e.name&&o.enabled(e.name)&&e.DEBUG||e.level,e.level);for(var n=0,a;a=r[n];n++)e[a]=t<=n?d:p(a)||typeof print=="function"&&print||d}function p(e,t){return(t=o.con())&&(t[e]||t.log).bind(t)}function d(){}var e=location.search.substring(1),l=e&&e.split("&"),m,u,y,h;try{m=localStorage.getItem("log");u=localStorage.getItem("debug")}catch(e){}for(y=0;h=l&&l[y]&&l[y].split("=");y++){h[0]=="log"?m=h[1]:0;h[0]=="debug"?u=h[1]:0}o.con=function(){return window.console&&console},u&&o.enable(u);var f=o();return o.level=m||o.WARN,f}()}(this);var applePay=function(){},session=null;function toCSS(e,i){var h={};function f(e,t,n){"number"!=typeof n||i.useRawValues||(n+="px");for(var a=t.split(/\s*,\s*/),o=0;o<a.length;o++){var r=a[o].replace(/_/g,"-");h[e][r]?h[e][r].push(n):h[e][r]=[n]}}if("string"==typeof e)return"/*\nUnable to parse JSS: "+e+"\n*/";!function e(t,n){for(var a in t&&!h[t]&&(h[t]={}),n){var o=n[a];if(o instanceof Array)for(var r=o,i=0;i<r.length;i++)f(t,a,r[i]);else switch(typeof o){case"number":case"string":f(t,a,o);break;case"object":var s=a.charAt(a.length-1);if(!t||"_"!==s&&"-"!==s)e(function(e,t){for(var n=[],a=t.split(/\s*,\s*/),o=e.split(/\s*,\s*/),r=0;r<o.length;r++)for(var i=o[r],s=0;s<a.length;s++){var c=a[s];"&"===c.charAt(0)?n.push(i+c.substr(1)):n.push(i?i+" "+c:c)}return n.join(", ")}(t,a),o);else{var c,p=o;for(c in p)for(var d=c.split(/\s*,\s*/),l=0;l<d.length;l++){var m=p[c];if(m instanceof Array)for(var u=m,y=0;y<u.length;y++)f(t,a+d[l],u[y]);else f(t,a+d[l],p[c])}}}}}("",e);var t,n="";for(t in h){var a,o=h[t];for(a in n+=t+" {\n",o)for(var r=o[a],s=0;s<r.length;s++)n+="\t"+a+": "+r[s]+";\n";n+="}\n"}return n}applePay.prototype.buildSession=function(e,n,t){this.request=e,this.request.supportedNetworks=e.supportedNetworks||["amex","chinaUnionPay","privateLabel","discover","visa","masterCard","jcb"],this.request.merchantCapabilities=e.merchantCapabilities||["supports3DS","supportsCredit","supportsDebit"];var i=e.server,s=this.request.merchantSiteId,e=1;ApplePaySession.supportsVersion(3)?e=3:ApplePaySession.supportsVersion(2)?e=2:ApplePaySession.supportsVersion(4)&&(e=4),delete this.request.server,delete this.request.merchantSiteId,session=new ApplePaySession(e,this.request);return session.onvalidatemerchant=function(e){var a,o,r;a=e.validationURL,o=s,r="/ppp/getAppleValidationApiFlow.do",new Promise(function(t,e){var n=new XMLHttpRequest;n.onload=function(){var e=JSON.parse(this.responseText);t(e.appleResponse)},n.onerror=e,n.timeout=3e4,n.ontimeout=e,n.open("GET",[i,r,"?merchant_site_id=",o,"&validationUrl=",a,"&ts=",(new Date).getTime()].join("")),n.send()}).then(function(e){session.completeMerchantValidation(e)}).catch(function(e){session.completeMerchantValidation(e)})},session.onpaymentauthorized=function(e){var t={token:e.payment.token};e.payment.billingContact&&(t.billingContact=e.payment.billingContact),e.payment.shippingContact&&(t.shippingContact=e.payment.shippingContact),n(t,function(e,t){t=t||[];t={status:e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE,errors:t};session.completePayment(t)})},session.oncancel=function(e){e={status:"canceled",errors:e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE};t(e)},this},applePay.prototype.completePayment=function(e){session.completePayment(e)},applePay.prototype.abort=function(e){e={status:"abort",errors:e?ApplePaySession.STATUS_SUCCESS:ApplePaySession.STATUS_FAILURE};applePayCallback(e),session.abort()};var defaults={truncateFirst:!(applePay.prototype.begin=function(){var t=this;this.oncancel&&(session.oncancel=function(e){t.oncancel(e)}),session.begin()}),container:null,containerName:"injectCSSContainer",useRawValues:!1,media:"all"};function injectCSS(e,t){var n=(t=Object.assign(defaults,t)).container||document.getElementById(t.containerName);n||(a=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).type="text/css",o.id=t.containerName,o.media=t.media,a.appendChild(o),n=document.getElementById(t.containerName));var a=void 0!==n.styleSheet&&void 0!==n.styleSheet.cssText,o="";return t.truncateFirst||(o+=a?n.styleSheet.cssText:n.textContent),o+=toCSS(e,t),a?n.styleSheet.cssText=o:n.textContent=o,n}var generateStyles=function(){"use strict";var i=["fontSmoothing"];function s(e,t,n){var a,o={};for(a in o[t]={},n){var r=getRule(a);o[t][r]=n[a]}return o}return function(e,t){var n,a,o={base:"",empty:".empty",valid:".valid",invalid:".invalid"},r={};for(n in t)void 0!==o[n]&&(a=function(t,n){var a,o={};for(a in o[t]={},n){var e,r=getRule(a);"string"==typeof r&&r.startsWith(":")?(e=s(0,t+r,n[a]),Object.assign(o,e)):-1<i.indexOf(a)?r.map(function(e){o[t][e]=n[a]}):"object"==typeof r&&n[a]?r.map(function(e){e=s(0,e,n[a]);Object.assign(o,e)}):r&&(o[t][r]=n[a])}return o}((e+{base:"",empty:".empty",valid:".valid",invalid:".invalid"}[n]).trim(),t[n]),Object.assign(r,a));return r}}();function objectToCSS(n){return Object.keys(n).map(e=>{var t=n[e];return`${getRule(e)}: ${t}`}).join(";")}function getRule(e){return{color:"color",fontFamily:"font-family",fontSize:"font-size",fontSmoothing:["font-smooth","-webkit-font-smoothing","-moz-osx-font-smoothing"],"-webkit-font-smoothing":"-webkit-font-smoothing","-moz-osx-font-smoothing":"-moz-osx-font-smoothing",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",lineHeight:"line-height",letterSpacing:"letter-spacing",textAlign:"text-align",textDecoration:"text-decoration",textShadow:"text-shadow",textTransform:"text-transform","::placeholder":["::-webkit-input-placeholder","::-moz-placeholder",":-ms-input-placeholder",":-moz-placeholder"],"::selection":["::selection","::-moz-selection"],"::-ms-clear":["::-ms-clear"],":-webkit-autofill":":-webkit-autofill",":disabled":":disabled",":focus":":focus",":hover":":hover",border:"border",borderRadius:"border-radius",opacity:"opacity",display:"display",width:"width",boxSizing:"box-sizing",alignItems:"align-items",margin:"margin",maxWidth:"max-width",minWidth:"min-width",flexWrap:"flex-wrap",flexDirection:"flex-direction",height:"height",backgroundColor:"background-color",outline:"outline",cursor:"cursor",zIndex:"z-index",position:"position",top:"top",left:"left",float:"float",clear:"clear",visibility:"visibility",padding:"padding",overflow:"overflow"}[e]}var UUIDjs=function(){"use strict";function s(){}return s.limitUI04=(s.maxFromBits=function(e){return Math.pow(2,e)})(4),s.limitUI06=s.maxFromBits(6),s.limitUI08=s.maxFromBits(8),s.limitUI12=s.maxFromBits(12),s.limitUI14=s.maxFromBits(14),s.limitUI16=s.maxFromBits(16),s.limitUI32=s.maxFromBits(32),s.limitUI40=s.maxFromBits(40),s.limitUI48=s.maxFromBits(48),s.randomUI04=function(){return Math.round(Math.random()*s.limitUI04)},s.randomUI06=function(){return Math.round(Math.random()*s.limitUI06)},s.randomUI08=function(){return Math.round(Math.random()*s.limitUI08)},s.randomUI12=function(){return Math.round(Math.random()*s.limitUI12)},s.randomUI14=function(){return Math.round(Math.random()*s.limitUI14)},s.randomUI16=function(){return Math.round(Math.random()*s.limitUI16)},s.randomUI32=function(){return Math.round(Math.random()*s.limitUI32)},s.randomUI40=function(){return(0|Math.random()*(1<<30))+(0|1024*Math.random())*(1<<30)},s.randomUI48=function(){return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<18))*(1<<30)},s.paddedString=function(e,t,n){n=n||"0";for(var a=t-(e=String(e)).length;0<a;a>>>=1,n+=n)1&a&&(e=n+e);return e},s.prototype.fromParts=function(e,t,n,a,o,r){return this.version=n>>12&15,this.hex=s.paddedString(e.toString(16),8)+"-"+s.paddedString(t.toString(16),4)+"-"+s.paddedString(n.toString(16),4)+"-"+s.paddedString(a.toString(16),2)+s.paddedString(o.toString(16),2)+"-"+s.paddedString(r.toString(16),12),this},s.prototype.toString=function(){return this.hex},s.prototype.toURN=function(){return"urn:uuid:"+this.hex},s.prototype.toBytes=function(){for(var e=this.hex.split("-"),t=[],n=0,a=0;a<e.length;a++)for(var o=0;o<e[a].length;o+=2)t[n++]=parseInt(e[a].substr(o,2),16);return t},s.prototype.equals=function(e){return e instanceof UUID&&this.hex===e.hex},s.getTimeFieldValues=function(e){var t=e-Date.UTC(1582,9,15),e=t/4294967296*1e4&268435455;return{low:1e4*(268435455&t)%4294967296,mid:65535&e,hi:e>>>16,timestamp:t}},s._create4=function(){return(new s).fromParts(s.randomUI32(),s.randomUI16(),16384|s.randomUI12(),128|s.randomUI06(),s.randomUI08(),s.randomUI48())},s._create1=function(){var e=(new Date).getTime(),t=s.randomUI14(),n=1099511627776*(1|s.randomUI08())+s.randomUI40(),a=s.randomUI04(),o=0;e!==o?(e<o&&t++,o=e,a=s.randomUI04()):Math.random()<.25&&a<9984?a+=1+s.randomUI04():t++;e=s.getTimeFieldValues(o),o=e.low+a,a=4095&e.hi|4096;return(new s).fromParts(o,e.mid,a,(t&=16383)>>>8|128,255&t,n)},s.create=function(e){return this["_create"+(e=e||4)]()},s.fromTime=function(e,t){t=t||!1;var n=s.getTimeFieldValues(e),a=n.low,e=4095&n.hi|4096;return!1===t?(new s).fromParts(a,n.mid,e,0,0,0):(new s).fromParts(a,n.mid,e,128|s.limitUI06,s.limitUI08-1,s.limitUI48-1)},s.firstFromTime=function(e){return s.fromTime(e,!1)},s.lastFromTime=function(e){return s.fromTime(e,!0)},s.fromURN=function(e){var t;return t===/^(?:urn:uuid:|\{)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{2})([0-9a-f]{2})-([0-9a-f]{12})(?:\})?$/i.exec(e)?(new s).fromParts(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16),parseInt(t[5],16),parseInt(t[6],16)):null},s.fromBytes=function(e){var t="",n=0,a=[4,2,2,2,6],o=0;if(e.length<5)return null;for(;o<a.length;o++){for(var r=0;r<a[o];r++){var i=e[n++].toString(16);t+=i=1===i.length?"0"+i:i}6!==a[o]&&(t+="-")}return s.fromURN(t)},s.fromBinary=function(e){for(var t=[],n=0;n<e.length;n++)if(t[n]=e.charCodeAt(n),255<t[n]||t[n]<0)throw new Error("Unexpected byte in binary data.");return s.fromBytes(t)},s}(),util={parseResult:function(e){var t={};try{t=JSON.parse(e)}catch(e){t={error:{type:"network",code:"invalid response",message:"SafeCharge Server returned invalid response"}}}return t}};function setOrderAmount(e,t,n){var a=new XMLHttpRequest;a.open("POST",e+"/ppp/api/v1/websdk/clientSetOrderAmount.do",!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.timeout=3e4,a.onerror=function(){n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},a.ontimeout=function(){return n({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},a.onload=function(){var e;200===a.status&&(e=util.parseResult(a.responseText),n(e))},a.send(JSON.stringify(t))}!function(e){function t(e){try{sessionStorage.test=1}catch(e){return}var t=document.createElement("script");t.type="text/javascript",t.src=e,t.crossorigin="anonymous",t.setAttribute("id","dynatraceScript"),document.head.appendChild(t)}var n,S,I={},y=null,h=null,f=null,v={},b={},g=ulog("safeCharge"),T="",C={},O=[],a=!0,c="",P="",E="";function i(e,t){var n=document.createElement("script");n.type="text/javascript",n.crossorigin="anonymous",n.onload=function(){t()},n.src=e,document.head.appendChild(n)}function s(){for(var e=0;e<document.scripts.length;e++){var t=document.scripts[e],n=-1<t.src.lastIndexOf("/safecharge.js")?t.src.lastIndexOf("/safecharge.js"):t.src.lastIndexOf("/websdk.js");if(-1<n)return t.src.substr(0,n+1)}}null!==document.getElementById("dynatraceScript")||("localhost"!==window.location.host.slice(0,9)&&"jsfiddle.net"!==window.location.hostname&&"fiddle.jshell.net"!==window.location.hostname&&"gw-4u"!==window.location.hostname.split(".")[1]&&"?qa"!==window.location.search?t("https://cdn.safecharge.com/jstag/managed/34ff9876-a972-4543-9110-773743828c28/bf45ff99493982c0_complete.js"):t("https://cdn.safecharge.com/jstag/managed/8b2d902e-39b0-46c8-8d1a-6df79ddd0d48/bf45ff99493982c0_complete.js"));var o,r=null,p=null;function k(e,n){var a=[];return e.forEach(function(e){if(!Array.isArray(e)){var t=e.toLocaleLowerCase();return n.brand&&t===n.brand.toLocaleLowerCase()||n.cardType&&t===n.cardType.toLocaleLowerCase()||n.issuerCountry&&t===n.issuerCountry.toLocaleLowerCase()||n.cardProduct&&t===n.cardProduct.toLocaleLowerCase()?a.push(!0):a.push(!1)}Array.isArray(e)&&(-1===e.map(function(e){e=e.toLocaleLowerCase();return!!(n.brand&&e===n.brand.toLocaleLowerCase()||n.cardType&&e===n.cardType.toLocaleLowerCase()||n.issuerCountry&&e===n.issuerCountry.toLocaleLowerCase()||n.cardProduct&&e===n.cardProduct.toLocaleLowerCase())}).indexOf(!1)?a.push(!0):a.push(!1))}),-1!==a.indexOf(!0)}function d(e){e=e.paymentOption;if(e){if(e.__makePayment||e.card&&e.card.CVV&&e.card.CVV.__makePayment)return"cc_card";if(e.card&&e.card.externalToken&&"GooglePay"===e.card.externalToken.externalTokenProvider)return"ppp_GooglePay";if(e.alternativePaymentMethod&&e.alternativePaymentMethod.paymentMethod)return e.alternativePaymentMethod.paymentMethod;if(e.userPaymentOptionId&&!e.alternativePaymentMethod)return"cc_card";if(e.card&&e.card.cardNumber)return"cc_card"}return""}function _(e){"function"==typeof I.onPaymentEvent&&(e.threeD&&!e.threeD.version&&E&&-1<E.indexOf("3DS1")&&(e.threeD.version="1.0.0"),"paymentStarted"===e.eventType&&e.threeD&&"true"===P&&!E&&(e.threeD.flow="frictionless"),e.pm=c,I.onPaymentEvent(e))}function A(n,a){g.info("---\x3e paymentFrame \n"+JSON.stringify(n,null,4)),g.trace("---\x3e paymentFrame \n"),r=n.paymentOption,p=n.transactionId,function(){(function(){var e=document.createElement("div");e.id="o"+UUIDjs.create(1).hex,w=e.id,e.node="dialog",e.style="display: display; overflow: auto; position: fixed; z-index: 9999; outline: 0px; background-color: rgba(210, 204, 204, 0.5); top: 0px; right: 0px; left: 0px; bottom: 0px;",e.innerHTML='<div class="sfcModal-dialog">\n        <div class="sfcModal-content" style="position:relative;background-color:#fff;background-clip:padding-box;outline:0;border:1px solid #dfdfdf;">\n            <div class="sfcModal-header">\n                <a role="button" data-dismiss="modal" aria-label="Close" class="sfcIcon--close sfcModal-close"></a>\n            </div>\n            <div class="sfcModal-body" style="-webkit-overflow-scrolling: touch;">\n            </div>\n        </div>\n    </div>',document.body.appendChild(e)})(),document.getElementById(w).style.display="block",setTimeout(function(){document.getElementById(w).classList.add("is-in")},300);var e=document.createElement("iframe");window.nuveiIframeName="i."+UUIDjs.create().hex,e.setAttribute("id","ifrm"),e.style="height: 420px;border: none !important; margin: 0 !important;padding: 0 !important;width: 1px !important;min-width: 100% !important;overflow: hidden !important;display: block !important;",e.setAttribute("name",nuveiIframeName),e.setAttribute("src",s()+"preloader.html?"+(new Date).getTime());var t=document.getElementsByClassName("sfcModal-body")[0];t.parentNode.insertBefore(e,t)}(),_({eventType:"challengeStarted",threeD:{version:r.card.threeD.version||"",flow:"challenge"}}),window.threeDPaymentActionId=callDtrum("enterAction",["challenge_started/challenge_complete",void 0,Date.now()]),document.querySelector("a.sfcIcon--close.sfcModal-close").addEventListener("click",function(){setTimeout(function(){document.getElementById(w).style.display="none",x()},300),_({eventType:"challengeEnded",threeD:{version:r.card.threeD.version||"",flow:"challenge"}}),callDtrum("sendSessionProperties",[null,null,{"3dauthobject":"cancelled:true"},null]),a({cancelled:!0})},{once:!0}),M||(window.addEventListener("message",function(e){var t={};try{t=JSON.parse(e.data)}catch(e){}t.threeDLoad&&document.getElementsByName(window.nuveiIframeName)[0].contentWindow.postMessage(JSON.stringify(r),"*"),g.info("---\x3e Auth 3ds data \n"+JSON.stringify(t,null,4)),g.trace("---\x3e Auth 3ds data \n"),t.paRes&&(setTimeout(function(){document.getElementById(w).style.display="none",callDtrum("leaveAction",[threeDPaymentActionId,Date.now()]),x()},300),t.cancelled=!1,_({eventType:"challengeEnded",threeD:{version:r.card.threeD.version||"",flow:"challenge"}}),callDtrum("sendSessionProperties",[null,null,{"3dauthobject":JSON.stringify(t)},null]),callDtrum("leaveAction",[threeDPaymentActionId,Date.now()]),a(t)),(t.result||""===t.result||t.transactionId||"-5"===t.errCode)&&(setTimeout(function(){document.getElementById(w).style.display="none",callDtrum("leaveAction",[threeDPaymentActionId,Date.now()]),x()},300),t.cancelled=!1,"authenticate3d"===n.all.sourceMethod&&(t.ccTempToken=n.ccTempToken,t.transactionId=p),_({eventType:"challengeEnded",threeD:{version:r.card.threeD.version||"",flow:"challenge"}}),callDtrum("sendSessionProperties",[null,null,{"3dauthobject":JSON.stringify(t)},null]),callDtrum("leaveAction",[threeDPaymentActionId,Date.now()]),a(t))}),M=!0)}e.dtBuffer=[],e.callDtrum=function(e,t){if("object"==typeof dtrum&&!0!==a){for(;dtBuffer.length;){var n=dtBuffer.shift();"enterAction"===n[0]?o=dtrum[n[0]].apply(this,n[1]):"leaveAction"===n[0]?(dtrum[n[0]].apply(this,[o,Date.now()]),o=void 0):dtrum[n[0]].apply(this,n[1])}return o&&"leaveAction"===e&&(t[0]=o),dtrum[e].apply(this,t)}dtBuffer.push([e,t])},window.addEventListener("beforeunload",function(){callDtrum("endSession"),callDtrum("disable")});function l(e){var t,n,a,o,r,i,s,c,p={};try{p=JSON.parse(e.data)}catch(e){}if("tooltip-action"===p.event){var d,l,m=p.message.payload.data,u=document.getElementById("toolTipMsg"),e=u.getBoundingClientRect();if("hidden"===m.visibility)return void(u.style.visibility=m.visibility);"cvv"===m.field?(u.style.visibility="visible",l=(d=document.getElementById("_cvc")).getBoundingClientRect(),v[d.name]&&v[d.name].options&&v[d.name].options.style&&v[d.name].options.style.cvvIcon&&"top"===v[d.name].options.style.cvvIcon.tooltipPosition?u.style.top=l.top-e.height+window.pageYOffset+"px":u.style.top=l.bottom+window.pageYOffset+2+"px",v[d.name]&&v[d.name].fieldsOptions&&("rtl"===v[d.name].fieldsOptions.textDirection||"he"===v[d.name].fieldsOptions.locale||"ar"===v[d.name].fieldsOptions.locale)?l.left-e.width/2<0?u.style.left=0:u.style.left=l.left-e.width/2+"px":l.right+e.width/2>document.documentElement.offsetWidth?u.style.left=l.right-e.width+"px":u.style.left=l.right-10-e.width/2+"px",e.width>=document.documentElement.offsetWidth&&(u.style.width=document.documentElement.offsetWidth-60+"px")):(u.style.visibility=m.visibility,l=(d=document.getElementById("one-field")).getBoundingClientRect(),v[d.name]&&v[d.name].options&&v[d.name].options.style&&v[d.name].options.style.cvvIcon&&"top"===v[d.name].options.style.cvvIcon.tooltipPosition?u.style.top=l.top-e.height+window.pageYOffset+"px":u.style.top=l.bottom+2+window.pageYOffset+"px",v[d.name]&&v[d.name].fieldsOptions&&("rtl"===v[d.name].fieldsOptions.textDirection||"he"===v[d.name].fieldsOptions.locale||"ar"===v[d.name].fieldsOptions.locale)?l.left-e.width/2<0?u.style.left=0:u.style.left=l.left-e.width/2+m.inputWrapperRect.width/4+"px":l.right+e.width/2>document.documentElement.offsetWidth?u.style.left=l.right-e.width+"px":u.style.left=m.inputWrapperRect.right-e.width/2-20+"px",e.width>document.documentElement.offsetWidth&&(u.style.width=document.documentElement.offsetWidth-10+"px"))}y&&"tokenize-result"===p.event&&(g.info("---\x3e "+p.event+"\n"+JSON.stringify(p,null,4)),g.trace("---\x3e "+p.event+"\n"),t=p.message.payload.data,setTimeout(function(){callDtrum("endSession")},1e3),setTimeout(function(){callDtrum("disable")},2e3),t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.v2supported&&"true"===t.paymentOption.card.threeD.v2supported?(u=t.paymentOption.card.threeD,t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},u.methodUrl||(t.paymentOption.card.threeD.methodCompletionInd="U",y(t)),u.methodUrl&&u.methodPayload&&R(u.methodUrl,u.methodPayload,function(e){t.paymentOption.card.threeD.methodCompletionInd=e,y(t)})):y(p.message.payload.data)),"init-payment-threeDVersion"===p.event&&(g.info("---\x3e "+p.event+"\n"+JSON.stringify(p,null,4)),g.trace("---\x3e "+p.event+"\n"),T=p.message.payload.data),"onPaymentEvent"===p.event&&(T=p.message.payload.data.threeDVersion,P=p.message.payload.data.v2supported,_({eventType:"tokenized",threeD:{version:T}})),"dcc-result"===p.event&&y(p.message.payload.data),"sightline-enroll-account-result"===p.event&&h(p.message.payload.data),"card-details-result"===p.event&&(y||f)(p.message.payload.data),f&&"make-payment-result"===p.event&&(g.info("---\x3e "+p.event+"\n"+JSON.stringify(p,null,4)),g.trace("---\x3e "+p.event+"\n"),(a=p.message.payload.data).paymentOption&&a.paymentOption.card&&a.paymentOption.card.threeD&&a.paymentOption.card.threeD.acsUrl&&(a.paymentOption.card.threeD.paRequest||a.paymentOption.card.threeD.cReq)?(a.paymentOption.card.threeD.paRequest&&(a.all.sourceMethod&&"createPayment"===a.all.sourceMethod?a.paymentOption.card.threeD.termUrl=a.all.server+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+a.sessionToken:a.all.sourceMethod&&"authenticate3d"===a.all.sourceMethod&&(a.paymentOption.card.threeD.termUrl=a.all.server+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+a.sessionToken)),E=a.paymentOption.card.threeD.acsUrl,_({eventType:"paymentStarted",threeD:{version:a.paymentOption.card.threeD.version||"",flow:"challenge"}}),A(a,function(e){f(e)})):(n=void 0===a.error?{}:a.error,a.paymentOption=a.paymentOption||{},a.paymentOption.card=a.paymentOption.card||{},a.paymentOption.card.threeD=a.paymentOption.card.threeD||{},_({eventType:"paymentStarted",threeD:{version:a.paymentOption.card.threeD.version||"",flow:""}}),o={result:a.transactionStatus||a.status||"ERROR",errCode:a.gwExtendedErrorCode||a.gwErrorCode||a.paymentMethodErrorCode||a.errorCode||n.code||a.errCode||"0",errorDescription:a.gwErrorReason||a.paymentMethodErrorReason||a.errorDescription||n.message||"",userPaymentOptionId:a.paymentOption.userPaymentOptionId||"",cavv:a.paymentOption.card.threeD.cavv||"",eci:a.paymentOption.card.threeD.eci||"",xid:a.paymentOption.card.threeD.xid||"",dsTransID:a.paymentOption.card.threeD.dsTransID||"",ccCardNumber:a.paymentOption.card.ccCardNumber||"",bin:a.paymentOption.card.bin||"",last4Digits:a.paymentOption.card.last4Digits||"",ccExpMonth:a.paymentOption.card.ccExpMonth||"",ccExpYear:a.paymentOption.card.ccExpYear||"",transactionId:a.transactionId,cancelled:!1,transactionStatus:a.transactionStatus,transactionType:a.transactionType},a.all&&"authenticate3d"===a.all.sourceMethod&&(o.ccTempToken=a.ccTempToken),a.partialApproval&&"createPayment"===a.all.sourceMethod&&(o.partialApproval=a.partialApproval),f(o))),"change"===p.event&&v[p.source]&&(i=v[p.source].stateClass.focus,n=v[p.source].stateClass.empty,a=v[p.source].stateClass.complete,o=v[p.source].stateClass.optional,v[p.source].parentElm.classList.remove(o),p.message.payload.empty?(v[p.source].parentElm.classList.add(n),(v[p.source].options.optional||p.message.payload.optional)&&v[p.source].parentElm.classList.add(o)):(v[p.source].parentElm.classList.remove(n),v[p.source].parentElm.classList.remove(o)),p.message.payload.complete?v[p.source].parentElm.classList.add(a):v[p.source].parentElm.classList.remove(a),p.message.payload&&p.message.payload.cardType&&"unknown"!==p.message.payload.cardType&&(C=p.message.payload),r=[],"ccCvc"!==v[p.source].field&&"ccExpiration"!==v[p.source].field||Object.keys(v).forEach(function(e){"ccNumber"!==v[e].field||v[e].peers.ccCvc!==p.source&&v[e].peers.ccExpiration!==p.source||((O=[]).push(p.source),v[e].peers.ccCvc&&O.push(v[e].peers.ccCvc),v[e].peers.ccExpiration&&O.push(v[e].peers.ccExpiration))}),"ccNumber"===v[p.source].field&&v[p.source].peers&&(v[p.source].peers.ccCvc||v[p.source].peers.ccExpiration)&&((O=[]).push(p.source),v[p.source].peers.ccCvc&&O.push(v[p.source].peers.ccCvc),v[p.source].peers.ccExpiration&&O.push(v[p.source].peers.ccExpiration)),O.includes(v[p.source].uuid)&&(O.forEach(function(e){r.push(v[e].parentElm.classList.contains("sfc-complete"))}),r.includes(!1)||0===r.length?p.message.payload.allFieldsCompleted=!1:p.message.payload.allFieldsCompleted=!0),D("change",v[p.source].subs,Object.assign({field:v[p.source].field},p.message.payload))),"focus"===p.event&&v[p.source]&&(i=v[p.source].stateClass.focus,v[p.source].parentElm.classList.add(i),D(p.event,v[p.source].subs,{field:v[p.source].field})),"paste"===p.event&&v[p.source]&&D(p.event,v[p.source].subs,{field:v[p.source].field}),"blur"===p.event&&v[p.source]&&(i=v[p.source].stateClass.focus,v[p.source].parentElm.classList.remove(i),D(p.event,v[p.source].subs,{field:v[p.source].field,fieldData:p.fieldData})),"load"===p.event&&v[p.source]&&v[p.source]._init(),"ready"===p.event&&(v[p.source]&&("_card"===v[p.source]._type&&p.message.payload.support19Digits,p.message.payload.data&&p.message.payload.data.style&&p.message.payload.data.style.base&&p.message.payload.data.style.base.fieldSize?v[p.source].frameElm.style.height=p.message.payload.data.style.base.fieldSize:0!==p.message.payload.height?v[p.source].frameElm.style.height=p.message.payload.height+"px":p.message.payload.data&&p.message.payload.data.style&&p.message.payload.data.style.base&&p.message.payload.data.style.base.fontSize?(i=p.message.payload.data.style.base.fontSize.match(/(\d+)/)).length&&(i=parseInt(i[0])+3,v[p.source].frameElm.style.height=i+"px"):v[p.source].frameElm.style.height="1rem",v[p.source].sendPeers()),D(p.event,v[p.source].subs,{field:v[p.source].field})),"keydown"===p.event&&v[p.source]&&D(p.event,v[p.source].subs,{field:v[p.source].field,keyCode:p.keyCode}),"enterXhrActionGetToken"===p.event&&(s=callDtrum("enterAction",["GetToken_started/GetToken_complete",void 0,Date.now()]),window.getTokenDo=s),"leaveXhrActionGetToken"===p.event&&callDtrum("leaveAction",[window.getTokenDo,Date.now()]),"enterXhrActionInit"===p.event&&(s=callDtrum("enterAction",["initPayment_started/initPayment_complete",void 0,Date.now()]),window.actionIdInit=s),"leaveXhrActionInit"===p.event&&callDtrum("leaveAction",[window.actionIdInit,Date.now()]),"enterXhrActionPayment"===p.event&&(c=callDtrum("enterAction",["clientPayment_started/clientPayment_complete",void 0,Date.now()]),window.actionIdPayment=c),"leaveXhrActionPayment"===p.event&&callDtrum("leaveAction",[window.actionIdPayment,Date.now()]),"enterXhrActionAuth"===p.event&&(c=callDtrum("enterAction",["clientAuthorize3d_started/clientAuthorize3d_complete",void 0,Date.now()]),window.requestAuthAction=c),"leaveXhrActionAuth"===p.event&&callDtrum("leaveAction",[window.requestAuthAction,Date.now()])}function D(e,t,n){t[e]&&t[e].forEach(function(e){e.call(n,n)})}function m(e,t,n){this.field=e.field,e.type&&(e.type="_"+e.type),e.targetHost={local:"https://dev-mobile.safecharge.com",test:"https://cdn-int.safecharge.com",prod:"https://cdn.safecharge.com",live:"https://cdn.safecharge.com",tag:"https://srv-bsf-devppptag.gw-4u.com"}[e.env||"prod"],this._type=e.type||"",this.options=e,this.fieldsOptions=n,this.uuid=t,this.subs={},this.frameElm=null,this.initialParentClasses="",this._state={destroyed:!1},this.stateClass={focus:"sfc-focus",empty:"sfc-empty",invalid:"sfc-invalid",complete:"sfc-complete",optional:"sfc-optional"},this.options.classes&&Object.assign(this.stateClass,this.options.classes),this.peers={}}function u(e){this.config=e,this.config.faction=UUIDjs.create().toString(),this.instances=[]}window.addEventListener("message",l,!1),m.prototype._sendMsg=function(e){e.type="td",e.source=this.uuid;var t=document.createElement("A");t.href=s();t=t.protocol+"//"+t.host;this.frameElm.contentWindow.postMessage(JSON.stringify(e),t)},m.prototype.sendPeers=function(){this._sendMsg({action:"add-member",payload:this.peers,origin:document.location.origin})},m.prototype._check=function(){if(this._state.destroyed)throw"The element has already been destroyed"},m.prototype._init=function(){this._check(),this._sendMsg({action:"init-field",support19Digits:n,payload:this.options,fieldsConfig:this.fieldsOptions,origin:document.location.origin,merchantDetails:I})},m.prototype.addMember=function(e){this.peers[e.type]=e.id},m.prototype.focus=function(){this._check(),this._sendMsg({action:"input-focus",source:this.uuid})},m.prototype.clear=function(){this._check(),this._sendMsg({action:"input-clear",source:this.uuid})},m.prototype.__tokenize=function(e,t,n){y=n,this._check(),this._sendMsg({extraData:t,action:"input-tokenize",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,env:e.env,all:e})},m.prototype.__getDCC=function(e,t,n){y=n,t.cardNumber={},this._check(),this._sendMsg({extraData:t,action:"get-dcc",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env})},m.prototype.__enrollSightlineAccount=function(e,t,n){h=n,this._check(),this._sendMsg({extraData:t,action:"enroll-sightline-account",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env})},m.prototype.__getCardDetails=function(e,t,n){y=n,this._check(),this._sendMsg({extraData:t,action:"get-card-details",sessionToken:e.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env})},m.prototype.__makePayment=function(e,t,n){var a,o;f=n,t.paymentOption.userPaymentOptionId?(a=t.paymentOption.userPaymentOptionId,o=t.paymentOption.card.expirationMonth,n=t.paymentOption.card.expirationYear,t.paymentOption={},t.paymentOption.card={},t.paymentOption.userPaymentOptionId=a,t.paymentOption.card.expirationMonth=o,t.paymentOption.card.expirationYear=n):t.paymentOption={},this._check(),this._sendMsg({extraData:t,action:"input-make-payment",sessionToken:e.sessionToken||t.sessionToken,merchantSiteId:e.merchantSiteId,merchantId:e.merchantId,env:e.env,all:e})},m.prototype.destroy=function(){this._check(),this._state.destroyed=!0,this.parentElm.innerHTML="",this.parentElm.className=this.initialParentClasses},m.prototype.attach=function(e){"string"==typeof e&&(e=document.querySelector(e));var t=this;(this.parentElm=e).addEventListener("click",function(){t.focus()});for(var n,a=e.nextElementSibling;a;)"LABEL"===a.tagName&&a.addEventListener("click",function(){t.focus()}),a=a.nextElementSibling;this.initialParentClasses=e.classList.value,e.classList.add("SfcField"),e.classList.add(this.stateClass.empty),this.options.optional&&e.classList.add(this.stateClass.optional),!this.options.cvvIcon||"_cvc"!==this.options.type&&""!==this._type||document.getElementById("toolTipMsg")||(r=document.createElement("div"),n="The 3 digit secure code on the back of your card",this.fieldsOptions&&this.fieldsOptions.i18n&&this.fieldsOptions.i18n.cvv_tooltip&&(n=this.fieldsOptions.i18n.cvv_tooltip),o={position:"absolute",visibility:"hidden",maxWidth:"100%",minWidth:"150px",backgroundColor:"black",color:"#fff",fontSize:"12px",textAlign:"center",borderRadius:"6px",padding:"5px 10px",zIndex:1,top:0,left:0,float:"left",clear:"left"},o=objectToCSS(o=this.options&&this.options.style&&this.options.style.tooltip?Object.assign(o,this.options.style.tooltip):o),r.setAttribute("id","toolTipMsg"),"rtl"===this.fieldsOptions.textDirection&&r.setAttribute("dir","rtl"),r.textContent=n,document.body.appendChild(r),document.head.insertAdjacentHTML("beforeend","<style> #toolTipMsg {"+o+"} </style>"),this.options.tooltipRect=r.getBoundingClientRect());var o=document.createElement("div");o.setAttribute("style","margin:0 !important; padding:0 !important;border:none !important;display:block !important;background:transparent !important;position:relative !important;opacity:1 !important;");var r=document.createElement("iframe");r.frameborder="0",r.allowtransparency="true",r.scrolling="no",r.name=this.uuid,r.allowpaymentrequest="true",r.src=s()+"sfc_inner"+this._type+".html?v1.121.0",r.title="SFC secure field",e.appendChild(o),r.setAttribute("style","border:none !important;margin:0 !important;padding:0 !important;width:1px !important;min-width:100% !important;overflow:hidden !important;display:block !important;height:0;"),r.setAttribute("id",this._type||"one-field"),this.frameElm=r,o.appendChild(r)},m.prototype.on=function(e,t){-1<["blur","change","focus","ready","paste","keydown"].indexOf(e)&&t&&"function"==typeof t&&(this.subs[e]||(this.subs[e]=[]),this.subs[e].push(t))};var w="o2087c6f6-7865-11e9-9143-116d91954306";function x(){document.getElementsByName(this.nuveiIframeName)[0].remove(),document.getElementById(w).remove()}var M=!(u.prototype.create=function(t,e){if("card"!==t&&"ccNumber"!==t&&"ccExpiration"!==t&&"ccCvc"!==t)throw"A valid Element name must be provided. Valid Elements is card\nyou requested: "+t+".";var n=UUIDjs.create().toString();"card"!==t&&(e.type={ccNumber:"card",ccExpiration:"exp",ccCvc:"cvc"}[t]);var a=this.config.alwaysCollectCvv;return"ccCvc"===t&&(e.optional=!0===e.optional||"optional"===a),"ccNumber"!==t&&"card"!==t||(e.cvcIsOptional=!0===e.cvcIsOptional||"optional"===a),e.field=t,e.env=I.env,e.cvvIcon=I.cvvIcon,v[n]=new m(e,n,this.config),this.instances.length&&this.instances.forEach(function(e){e.instance.addMember({type:t,id:n})}),this.instances.push({type:t,instance:v[n]}),v[n]}),R=function(e,t,o){var n=document.createElement("form");n.style.display="none",n.id="u"+UUIDjs.create(1).hex;var r=document.createElement("iframe");r.style.display="none",r.name="i"+UUIDjs.create(1).hex;var a=document.createElement("input");document.body.appendChild(r),n.method="POST",n.action=e,n.target=r.name,a.value=t,a.name="threeDSMethodData",n.appendChild(a),document.body.appendChild(n);a={};try{a=JSON.parse(atob(t))}catch(e){}var i=a.threeDSServerTransID;n.submit();var s=setTimeout(function(){window.removeEventListener("message",c,!1),o("N")},15050),c=function(e){clearTimeout(s),window.removeEventListener("message",c,!1);var t={};if(document.getElementsByName(r.name)[0].remove(),e.data)try{if(2!==(t=JSON.parse(e.data)).response.split("=").length)return o("N");var n=atob(t.response.split("=")[1]),a={threeDSServerTransID:!1};try{a=JSON.parse(n)}catch(e){return o("N")}return a.threeDSServerTransID&&a.threeDSServerTransID===i?o("Y"):o("N")}catch(e){return o("N")}};window.addEventListener("message",c,{once:!0}),document.getElementById(n.id).remove()},N=function(e){var t={};try{t=JSON.parse(e)}catch(e){t={error:{type:"network",code:"invalid response",message:"SafeCharge Server returned invalid response"}}}return t};e.SafeCharge=function(O){callDtrum("disable"),callDtrum("setAutomaticActionDetection",[!1]),callDtrum("setLoadEndManually"),callDtrum("enable");var e=callDtrum("enterAction",["init webSDK",void 0,Date.now()]);b={},O=O||{},I.sessionToken=O.sessionToken,I.env=O.env||"prod",I.merchantSiteId=O.merchantSiteId,I.merchantId=O.merchantId,I.sourceApplication=O.sourceApplication,I.logLevel=O.logLevel||0,I.blockCards=O.blockCards,I.cvvIcon=O.cvvIcon||!1,n=O.support19Digits||!1,I.maskCvv=O.maskCvv||!1,I.onPaymentEvent=O.onPaymentEvent,I.disableNuveiAnalytics=O.disableNuveiAnalytics,g.level=I.logLevel;var D=null,w={prod:"https://secure.safecharge.com",int:"https://ppp-test.safecharge.com",test:"https://ppp-test.safecharge.com",qa:"https://apmtest.gate2shop.com",dev:"https://dev-mobile.safecharge.com",local:"https://dev-mobile.safecharge.com",live:"https://secure.safecharge.com",tag:"https://srv-bsf-devppptag.gw-4u.com"}[I.env]||"https://secure.safecharge.com";return I.server=w,a=!0===I.disableNuveiAnalytics,callDtrum("sendSessionProperties",[null,null,{websdk_version:"v1.121.0"},null]),callDtrum("sendSessionProperties",[null,null,{merchantid:I.merchantId},null]),callDtrum("sendSessionProperties",[null,null,{merchantsiteid:I.merchantSiteId},null]),I.sessionToken&&callDtrum("sendSessionProperties",[null,null,{sessiontoken:I.sessionToken},null]),callDtrum("sendSessionProperties",[null,null,{initobject:JSON.stringify(I)},null]),callDtrum("leaveAction",[e,Date.now()]),setTimeout(function(){callDtrum("disable")},3e3),{fields:function(e){return new u(e)},getDirectUPOs:function(){return{apmgw_Secure_Bank_Transfer:!0}},enrollSightlineAccountWithFund:function(e,t){var n,a=[];for(n in v)"ccNumber"===v[n].field&&a.push(v[n]);a.pop().__enrollSightlineAccount(I,e,t)},initSightline:function(e,t,n,a){if(void 0===e)throw"please provide all parameters for initSightline method";if(void 0===t)throw"please provide all parameters for initSightline method";if(void 0===n)throw"please provide all parameters for initSightline method";if(void 0===a)throw"please provide all parameters for initSightline method";var o=s()+"fields/sightline.js",r=this;i(o,function(){try{sightlineNuvei.init(e,t,n,I,r,a)}catch(e){}})},createGlobalpayPayment:function(e,t){if(void 0===e||void 0===t)throw"please provide all parameters for createGlobalpayPayment method";void 0!==globalpay.paymentVals?(e.paymentOption={alternativePaymentMethod:{paymentMethod:"apmgw_VIP_Preferred",globalpay_accountId:globalpay.paymentVals.accountNumber,globalpay_bankAccount:globalpay.paymentVals.selectedAccount,globalpay_firstName:globalpay.paymentVals.firstName,globalpay_lastName:globalpay.paymentVals.lastName,globalpay_phone:globalpay.paymentVals.phone}},c="apmgw_VIP_Preferred",this.createPayment(e,t)):this.initGlobalpay(globalpay.placeholder,globalpay.globalpayParams,globalpay.styleObject,globalpay.cb)},createSightlinePayment:function(e,t){c="apmgw_PlayPlus",_({eventType:"initiated"});if(e.billingAddress&&sightlineNuvei.sightlineParams.billingAddress&&(e.billingAddress.firstName=sightlineNuvei.sightlineParams.billingAddress.firstName,e.billingAddress.lastName=sightlineNuvei.sightlineParams.billingAddress.lastName),e.userDetails&&sightlineNuvei.sightlineParams.userDetails&&(e.userDetails.firstName=sightlineNuvei.sightlineParams.userDetails.firstName,e.userDetails.lastName=sightlineNuvei.sightlineParams.userDetails.lastName,e.userDetails.identification=sightlineNuvei.sightlineParams.userDetails.identification),e.paymentOption&&e.paymentOption.userPaymentOptionId)e.paymentOption.alternativePaymentMethod={paymentMethod:"apmgw_PlayPlus"};else if(e.paymentOption={alternativePaymentMethod:{paymentMethod:"apmgw_PlayPlus",sightline_ssn:sightlineNuvei.ssnVal}},sightlineNuvei.checkFields&&sightlineNuvei.checkFields(),sightlineNuvei.checkSSN&&sightlineNuvei.checkSSN(),!sightlineNuvei.isValidSSN)return void t({status:"ERROR",type:"invalid input field",code:"invalid input field",errorDescription:"invalid SSN"});!function(e,n){e.hasOwnProperty("useDCC")&&(e.useDcc=e.useDCC,delete e.useDCC),e.hasOwnProperty("savePM")&&(e.paymentOption.savePm=e.savePM,delete e.savePM);var a=new XMLHttpRequest;a.open("POST",w+"/ppp/api/v1/clientPayment.do",!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.timeout=6e4,a.onerror=function(){n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},a.ontimeout=function(){return n({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},a.onload=function(){var e,t;200===a.status?(_({eventType:"paymentStarted"}),callDtrum("leaveAction",[window.clintPaymentDoId,Date.now()]),void 0===(e=N(a.responseText)).all&&(e.all={}),e.all.sourceMethod="createPayment",e.all.server=w,"ERROR"===e.status?n(e):"SUCCESS"===e.status&&(e.paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},t={result:e.transactionStatus,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||"",userPaymentOptionId:e.paymentOption.userPaymentOptionId,ccCardNumber:e.paymentOption.card.ccCardNumber,bin:e.paymentOption.card.bin,last4Digits:e.paymentOption.card.last4Digits||"",ccExpMonth:e.paymentOption.card.ccExpMonth||"",ccExpYear:e.paymentOption.card.ccExpYear||"",transactionId:e.transactionId,cancelled:!1},e.partialApproval&&(t.partialApproval=e.partialApproval),n(t))):n(fixIncorrectResult(a.responseText))},e.sourceApplication=I.sourceApplication||"WEB_SDK";var t=callDtrum("enterAction",["payment_started/payment_complete",void 0,Date.now()]);window.clintPaymentDoId=t,a.send(JSON.stringify(e))}(e,t)},initGlobalpay:function(e,t,n,a){if(void 0===e)throw"please provide all parameters for initGlobalpay method";if(void 0===t)throw"please provide all parameters for initGlobalpay method";if(void 0===n)throw"please provide all parameters for initGlobalpay method";if(void 0===a)throw"please provide all parameters for initGlobalpay method";i(s()+"fields/globalPay.js",function(){try{globalpay.init(e,t,n,I,a)}catch(e){}})},enrollAccount:function(e,t){sightline.sightlineEnrollAccount(w,e,t)},authenticate3d:function(o,r){var i,s;function t(){if(o.openAmount&&delete o.openAmount,o.paymentOption.card,g.trace("---\x3e TRACE authenticate3d \n"),!o.merchantSiteId&&I.merchantSiteId&&(o.merchantSiteId=I.merchantSiteId),!o.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!o.merchantId&&I.merchantId&&(o.merchantId=I.merchantId),!o.merchantId)throw new Error("Merchant id is mandatory.");function n(e,n){var a;e.ccTempToken&&(a=e.ccTempToken,delete e.ccTempToken),e.useDCC&&(e.useDcc=e.useDCC,delete e.useDCC),e.hasOwnProperty("savePM")&&(e.paymentOption.savePm=e.savePM,delete e.savePM);var o=new XMLHttpRequest;o.open("POST",w+"/ppp/api/v1/clientAuthorize3d.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){callDtrum("leaveAction",[r,Date.now()]);n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},o.ontimeout=function(){return callDtrum("leaveAction",[r,Date.now()]),n({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},o.onload=function(){var e,t;200===o.status?(callDtrum("leaveAction",[r,Date.now()]),void 0===(e=N(o.responseText)).all&&(e.all={}),e.all.sourceMethod="authenticate3d",e.all.server=w,"ERROR"===e.status?(e.error={type:"card",code:e.errCode},e.error.message=e.reason||"Process failed.",n(s(e))):"SUCCESS"===e.status&&(e.ccTempToken=a,e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&e.paymentOption.card.threeD.acsUrl&&(e.paymentOption.card.threeD.paRequest||e.paymentOption.card.threeD.cReq)?(e.paymentOption.card.threeD.paRequest&&(e.paymentOption.card.threeD.termUrl=w+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+e.sessionToken),E=e.paymentOption.card.threeD.acsUrl,_({eventType:"paymentStarted",threeD:{version:e.paymentOption.card.threeD.version||"",flow:"challenge"}}),i.paymentFrame(e,function(e){tempData&&tempData.paymentOption&&tempData.paymentOption.card&&tempData.paymentOption.card.threeD&&tempData.paymentOption.card.threeD.version&&(e.threeDVersion=tempData.paymentOption.card.threeD.version||"",delete window.tempData),n(s(e))})):(e.paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},e.paymentOption.card.threeD=e.paymentOption.card.threeD||{},_({eventType:"paymentStarted",threeD:{version:e.paymentOption.card.threeD.version||"",flow:""}}),t={result:e.transactionStatus,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||"",userPaymentOptionId:e.paymentOption.userPaymentOptionId||"",cavv:e.paymentOption.card.threeD.cavv||"",eci:e.paymentOption.card.threeD.eci||"",xid:e.paymentOption.card.threeD.xid||"",dsTransID:e.paymentOption.card.threeD.dsTransID||"",ccCardNumber:e.paymentOption.card.ccCardNumber||"",bin:e.paymentOption.card.bin||"",last4Digits:e.paymentOption.card.last4Digits||"",ccExpMonth:e.paymentOption.card.ccExpMonth||"",ccExpYear:e.paymentOption.card.ccExpYear||"",threeDVersion:e.paymentOption.card.threeD.version||"",transactionId:e.transactionId,cancelled:!1},e.all&&"authenticate3d"===e.all.sourceMethod&&(t.ccTempToken=e.ccTempToken),n(s(t))))):n(s(o.responseText))},e.sourceApplication=I.sourceApplication||"WEB_SDK";var r=callDtrum("enterAction",["verify3d_started/verify3d_complete",void 0,Date.now()]);o.send(JSON.stringify(e))}var e=!1;try{e=navigator.javaEnabled()}catch(e){}var t,a={acceptHeader:"Y",userAgent:navigator.userAgent,javaEnabled:e,language:navigator.language,colorDepth:screen.colorDepth,screenHeight:screen.height,screenWidth:screen.width,timeZone:(new Date).getTimezoneOffset(),javaScriptEnabled:!0};I.sourceMethod="authenticate3d",o.paymentOption&&o.paymentOption.__makePayment?(C&&(o._validationState=C),o.browserDetails=a,o.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",o.paymentOption.__makePayment(I,o,function(e){e.threeDVersion=T,r(s(e))})):o.paymentOption&&o.paymentOption.userPaymentOptionId&&o.paymentOption.card&&o.paymentOption.card.CVV&&o.paymentOption.card.CVV.__makePayment?(C&&(o._validationState=C),o.browserDetails=a,o.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",o.paymentOption.card.CVV.__makePayment(I,o,function(e){r(s(e))})):(o.sourceApplication=I.sourceApplication||"WEB_SDK",(t=JSON.parse(JSON.stringify(o))).paymentOption=t.paymentOption||{},t.paymentOption.useInitPayment=!0,delete t.shippingAddress,delete t.userDetails,delete t.useDCC,delete t.savePM,delete t.clientRequestId,I.blockCards&&0<I.blockCards.length&&t.paymentOption.card&&t.paymentOption.card.cardNumber?i.getCardDetails({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,cardNumber:t.paymentOption.card.cardNumber},function(e){"ERROR"===e.status?r(s(e)):k(I.blockCards,e)?(result={errCode:-6,result:"ERROR",errDescription:"card type blocked"},r(s(result))):i.initPayment(t,function(e){o.paymentOption=o.paymentOption||{},window.tempData=e;var t=JSON.parse(JSON.stringify(o));t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},e.paymentOption&&(t.ccTempToken=e.paymentOption.card.ccTempToken),delete t.currency,delete t.amount;e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=a,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02",t.paymentOption.card.threeD.isDynamic3D=0,"true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=w+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+o.sessionToken),"false"===e.paymentOption.card.threeD.v2supported&&(t.paymentOption.card.threeD={}),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd),t.paymentOption.card.threeD.version),n(t,r)})}):i.initPayment(t,function(e){o.paymentOption=o.paymentOption||{},window.tempData=e;var t=JSON.parse(JSON.stringify(o));t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},e.paymentOption&&(t.ccTempToken=e.paymentOption.card.ccTempToken),delete t.currency,delete t.amount;e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=a,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02",t.paymentOption.card.threeD.isDynamic3D=0,"true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=w+"/ppp/api/threeDSecure/completeVerify3d.do?sessionToken="+o.sessionToken),"false"===e.paymentOption.card.threeD.v2supported&&(t.paymentOption.card.threeD={}),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd),t.paymentOption.card.threeD.version),n(t,r)}))}!0!==b.isProcessing?(b.isProcessing=!0,I.env&&"int"===I.env.toLocaleLowerCase()?callDtrum("disable"):callDtrum("enable"),c=d(o),_({eventType:"initiated"}),o.paymentOption.peers?o.paymentOption.peers.ccCvc?callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_THREE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_ONE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_NOFIELDS"},null]),o.billingAddress&&o.billingAddress.email?(callDtrum("sendSessionProperties",[null,null,{usertokenid:o.billingAddress.email},null]),callDtrum("identifyUser",[o.billingAddress.email+" / "+I.merchantId])):callDtrum("identifyUser",[UUIDjs.create().hex.split("-")[0]+" / "+I.merchantId]),o.sessionToken&&callDtrum("sendSessionProperties",[null,null,{sessiontoken:o.sessionToken},null]),i=this,s=function(e){return setTimeout(function(){callDtrum("endSession")},1e3),setTimeout(function(){callDtrum("disable")},2e3),b={},e},o.openAmount?this.setOpenAmount({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,amount:o.openAmount,currency:o.currency,clientRequestId:o.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:o.clientUniqueId},function(e){"ERROR"===e.status?r(s(e)):t()}):t()):r({processingOrder:!0})},getApms:function(e,t){g.info("---\x3e sfc.getAmps() input object---------------------- \n"+JSON.stringify(e,null,4)),g.trace("---\x3e sfc.getAmps() stack trace---------------------- \n");var n=new XMLHttpRequest;n.open("POST",w+"/ppp/api/v1/getMerchantPaymentMethods.do",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=6e4,n.onerror=function(){callDtrum("leaveAction",[o,Date.now()]);t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},n.ontimeout=function(){return callDtrum("leaveAction",[o,Date.now()]),t({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},n.onload=function(){callDtrum("leaveAction",[o,Date.now()]),200===n.status?t(N(n.responseText)):t(n.responseText)};var a={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,timeStamp:(new Date).getTime(),clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random())};a.type=e.type||"DEPOSIT",e.currencyCode&&(a.currencyCode=e.currencyCode),e.countryCode&&(a.countryCode=e.countryCode),a.languageCode=e.languageCode||"en";var o=callDtrum("enterAction",["getApms",void 0,Date.now()]);n.send(JSON.stringify(a))},getUserUPOs:function(e){g.trace("---\x3e sfc.getUserUPOs() stack trace---------------------- \n");var t=new XMLHttpRequest;t.open("POST",w+"/ppp/api/v1/websdk/clientGetUserUPOs.do",!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.timeout=6e4,t.onerror=function(){callDtrum("leaveAction",[a,Date.now()]);e({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},t.ontimeout=function(){return callDtrum("leaveAction",[a,Date.now()]),e({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},t.onload=function(){callDtrum("leaveAction",[a,Date.now()]),200===t.status?e(N(t.responseText)):e(t.responseText)};var n={sessionToken:I.sessionToken,merchantSiteId:I.merchantSiteId,merchantId:I.merchantId,clientRequestId:Math.ceil(1e16*Math.random())},a=callDtrum("enterAction",["getUserUPOs",void 0,Date.now()]);t.send(JSON.stringify(n))},clientGetDccDetails:function(e,t){if(e.cardNumber&&e.cardNumber.__getDCC)e.cardNumber.__getDCC(I,e,t);else if(!0===e.useFields){var n,a=[];for(n in v)"ccNumber"===v[n].field&&a.push(v[n]);a.pop().__getDCC(I,e,t)}else{var o=new XMLHttpRequest;o.open("POST",w+"/ppp/api/v1/websdk/clientGetDccDetails.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},o.ontimeout=function(){return t({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},o.onload=function(){200===o.status?t(N(o.responseText)):t(o.responseText)};var r={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:e.clientUniqueId,currency:e.currency,country:e.country};e.cardNumber?r.cardNumber=e.cardNumber:e.userPaymentOptionId?r.userPaymentOptionId=e.userPaymentOptionId:r.apm=e.apm,o.send(JSON.stringify(r))}},getCardDetails:function(e,t){if(e.cardNumber&&e.cardNumber.__getCardDetails)e.cardNumber.__getCardDetails(I,e,t);else if(!0===e.useFields){var n,a=[];for(n in v)"ccNumber"===v[n].field&&a.push(v[n]);a.pop().__getCardDetails(I,e,t)}else{var o=new XMLHttpRequest;o.open("POST",w+"/ppp/api/v1/getCardDetails.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},o.ontimeout=function(){return t({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},o.onload=function(){200===o.status?t(N(o.responseText)):t(o.responseText)};var r={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,clientRequestId:e.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:e.clientUniqueId};e.userPaymentOptionId&&(r.userPaymentOptionId=e.userPaymentOptionId),e.cardNumber&&(r.cardNumber=e.cardNumber),o.send(JSON.stringify(r))}},accountCapture:function(e,t){var n=new XMLHttpRequest;n.open("POST",w+"/ppp/api/v1/accountCapture.do",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.timeout=6e4,n.onerror=function(){t({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},n.ontimeout=function(){return t({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},n.onload=function(){200===n.status?t(N(n.responseText)):t(n.responseText)};e={sessionToken:I.sessionToken||e.sessionToken,merchantSiteId:I.merchantSiteId||e.merchantSiteId,merchantId:I.merchantId||e.merchantId,amount:e.amount,paymentMethod:e.paymentMethod,userTokenId:e.userTokenId,countryCode:e.countryCode,currencyCode:e.currencyCode,languageCode:e.languageCode,notificationUrl:e.notificationUrl,sourceApplication:e.sourceApplication,userDetails:e.userDetails,deviceDetails:e.deviceDetails};n.send(JSON.stringify(e))},buildApplePaySession:function(e,t,n){if(!e.merchantSiteId&&e.merchantSiteId&&(e.merchantSiteId=I.merchantSiteId),!e.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!e.merchantId&&I.merchantId&&(e.merchantId=I.merchantId),!e.merchantId)throw new Error("Merchant id is mandatory.");if(!e.env&&I.env&&(e.env=I.env),!e.env)throw new Error("env is mandatory.");e={merchantSiteId:e.merchantSiteId,server:w,merchantCapabilities:e.merchantCapabilities||null,supportedNetworks:e.supportedNetworks,countryCode:e.countryCode,currencyCode:e.currencyCode,total:{label:e.total.label,amount:e.total.amount}};(new applePay).buildSession(e,t,n).begin()},createApplePayPaymentWithoutBuildSession:function(t,n){S=t.completion,this.createPayment({sessionToken:t.sessionToken||I.sessionToken,merchantId:t.merchantId||I.merchantId,merchantSiteId:t.merchantSiteId||I.merchantSiteId,amount:t.amount,currency:t.currency||t.currencyCode,useDcc:t.useDCC,paymentOption:t.paymentOption},function(e){e.result&&"APPROVED"===e.result?t.completion&&t.completion(!0):t.completion&&t.completion(!1),n(e)})},createApplePayPayment:function(n,a){if(!n.merchantSiteId&&n.merchantSiteId&&(n.merchantSiteId=I.merchantSiteId),!n.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!n.merchantId&&I.merchantId&&(n.merchantId=I.merchantId),!n.merchantId)throw new Error("Merchant id is mandatory.");if(!n.env&&I.env&&(n.env=I.env),!n.env)throw new Error("env is mandatory.");var e={merchantSiteId:n.merchantSiteId,server:w,merchantCapabilities:n.merchantCapabilities||null,supportedNetworks:n.supportedNetworks,countryCode:n.countryCode,currencyCode:n.currencyCode,total:{label:n.total.label,amount:n.total.amount}};c="ppp_ApplePay";var o=this;(new applePay).buildSession(e,function(e,t){S=t,o.createPayment({sessionToken:n.sessionToken||I.sessionToken,merchantId:n.merchantId||I.merchantId,merchantSiteId:n.merchantSiteId||I.merchantSiteId,amount:n.amount,currency:n.currency||n.currencyCode,useDcc:n.useDCC,paymentOption:{paymentMethod:"ppp_ApplePay",card:{externalToken:{externalTokenProvider:"ApplePay",mobileToken:JSON.stringify(e.token)}}}},function(e){e.result&&e.result,t&&t(!1),a(e)})},a).begin()},createPayment:function(h,f){var v,g;function t(){if(h.openAmount&&delete h.openAmount,!h.merchantSiteId&&I.merchantSiteId&&(h.merchantSiteId=I.merchantSiteId),!h.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!h.merchantId&&I.merchantId&&(h.merchantId=I.merchantId),!h.merchantId)throw new Error("Merchant id is mandatory.");var e={apmgw_WeBanq:!0,apmgw_Moneta__Direct_Integration_:!0,apmgw_Todito_Cash_Direct_Integration_:!0,apmgw_Webmoney_SMS_Invoice_:!0,entropay:!0,visa_checkout:!0,apmgw_WeChat_QuickPay:!0,apmgw_AstropayPrePaid:!0,apmgw_AliPay_Barcode:!0,apmgw_BLIK:!0,apmgw_MuchBetter:!0,apmgw_eCheck:!0,apmgw_MBWAY:!0,apmgw_Playtech_Prepaidcard:!0,apmgw_PlayPlus:!0,apmgw_VIP_Preferred:!0,apmgw_ACH:!0,apmgw_Abon:!0},t="pppApmWindow_"+(new Date).getTime(),r=null;window.skipGetPaymentStatus=!1;function n(e,n){var a=e.apmWindowType;e.hasOwnProperty("useDCC")&&(e.useDcc=e.useDCC,delete e.useDCC),e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&e.paymentOption.card.externalToken&&("GooglePay"===e.paymentOption.card.externalToken.externalTokenProvider||"ApplePay"===e.paymentOption.card.externalToken.externalTokenProvider)&&(P||(delete e.paymentOption.card.threeD,delete e.relatedTransactionId)),e&&e.paymentOption&&e.paymentOption.alternativePaymentMethod&&e.paymentOption.alternativePaymentMethod.paymentMethod&&"visa_checkout"===e.paymentOption.alternativePaymentMethod.paymentMethod&&delete e.paymentOption.alternativePaymentMethod,e.hasOwnProperty("savePM")&&(e.paymentOption.savePm=e.savePM,delete e.savePM);var o=new XMLHttpRequest;o.open("POST",w+"/ppp/api/v1/clientPayment.do",!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onerror=function(){callDtrum("leaveAction",[window.clintPaymentDoId,Date.now()]),r&&r.close();n({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},o.ontimeout=function(){return callDtrum("leaveAction",[window.clintPaymentDoId,Date.now()]),r&&r.close(),n({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},o.onload=function(){if(callDtrum("leaveAction",[window.clintPaymentDoId,Date.now()]),200===o.status){if(void 0===(t=N(o.responseText)).all&&(t.all={}),t.all.sourceMethod="createPayment",t.all.server=w,"ERROR"===t.status){if(r){if(1058===t.errCode)return b={},window.skipGetPaymentStatus=!0,r.close(),void n(t);r.close()}t.error={type:"card",code:t.errCode},t.error.message=t.reason||"Process failed.",n(g(t))}else if("SUCCESS"===t.status)if(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.acsUrl&&(t.paymentOption.card.threeD.paRequest||t.paymentOption.card.threeD.cReq))t.paymentOption.card.threeD.paRequest&&(t.paymentOption.card.threeD.termUrl=w+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+t.sessionToken),S&&S(!0),E=t.paymentOption.card.threeD.acsUrl,_({eventType:"paymentStarted",threeD:{version:t.paymentOption.card.threeD.version||"",flow:"challenge"}}),v.paymentFrame(t,function(e){n(g(e))});else{var e={eventType:"paymentStarted"};if(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&(e.threeD={version:t.paymentOption.card.threeD.version||"",flow:""},E=t.paymentOption.card.threeD.acsUrl),_(e),t.paymentOption=t.paymentOption||{},"REDIRECT"===t.transactionStatus)"redirect"===a?(window.top.location=t.paymentOption.redirectUrl,_({eventType:"redirectionStarted"})):"customRedirect"===a?n(g(t)):(r.location=t.paymentOption.redirectUrl,_({eventType:"redirectionStarted"}));else{if("ERROR"===t.transactionStatus||"DECLINED"===t.transactionStatus||null==t.transactionStatus)try{window.skipGetPaymentStatus=!0,r&&r.close()}catch(e){}if(1069===t.errCode)try{r.close()}catch(e){}t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{};var t,e={result:(t=g(t)).transactionStatus,errCode:t.gwExtendedErrorCode||t.gwErrorCode||t.paymentMethodErrorCode||t.errorCode||"0",errorDescription:t.gwErrorReason||t.paymentMethodErrorReason||t.errorDescription||"",userPaymentOptionId:t.paymentOption.userPaymentOptionId,ccCardNumber:t.paymentOption.card.ccCardNumber,bin:t.paymentOption.card.bin,last4Digits:t.paymentOption.card.last4Digits||"",ccExpMonth:t.paymentOption.card.ccExpMonth||"",ccExpYear:t.paymentOption.card.ccExpYear||"",transactionId:t.transactionId,cancelled:!1};t.partialApproval&&(e.partialApproval=t.partialApproval),n(e)}}}else n(g(o.responseText))},delete e.apmWindowType,e.sourceApplication=I.sourceApplication||"WEB_SDK";var t=callDtrum("enterAction",["payment_started/payment_complete",void 0,Date.now()]);window.clintPaymentDoId=t,o.send(JSON.stringify(e))}var a=!1;try{a=navigator.javaEnabled()}catch(e){}var o,i,s,c,p,d,l,m,u,y={acceptHeader:"Y",userAgent:navigator.userAgent,javaEnabled:a,language:navigator.language,colorDepth:screen.colorDepth,screenHeight:screen.height,screenWidth:screen.width,timeZone:(new Date).getTimezoneOffset(),javaScriptEnabled:!0};I.sourceMethod="createPayment",h.paymentOption&&h.paymentOption.__makePayment?(C&&(h._validationState=C),h.browserDetails=y,h.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",h.paymentOption.__makePayment(I,h,function(e){f(g(e))})):h.paymentOption&&h.paymentOption.userPaymentOptionId&&h.paymentOption.card&&h.paymentOption.card.CVV&&h.paymentOption.card.CVV.__makePayment?(C&&(h._validationState=C),h.browserDetails=y,h.sourceApplication=I.sourceApplication||"WEB_SDK_FIELDS",h.paymentOption.card.CVV.__makePayment(I,h,function(e){f(g(e))})):h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&v.getDirectUPOs()[h.paymentOption.alternativePaymentMethod.paymentMethod]&&h.paymentOption.userPaymentOptionId?(delete h._validationState,n(h,f)):h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&!e[h.paymentOption.alternativePaymentMethod.paymentMethod]&&!h.isDirectAPM&&"redirect"!==h.apmWindowType?(delete h._validationState,h.billingAddress&&h.billingAddress.email&&h.paymentOption.subMethod&&void 0===h.paymentOption.subMethod.email&&"skrill1tap"===h.paymentOption.subMethod.subMethod.toLocaleLowerCase()&&(h.paymentOption.subMethod.email=h.billingAddress.email),i=0,"object"!=typeof O.pollApm||"object"==typeof(d=O.pollApm[h.paymentOption.alternativePaymentMethod.paymentMethod])&&d.pollingCount===parseInt(d.pollingCount,10)&&d.pollingTime===parseInt(d.pollingTime,10)&&(o=d.pollingCount,i=d.pollingTime),s=!0,clearTimeout(D),c=(l={w:800,h:600}).w,p=l.h,a=screen.width/2-c/2,d=screen.height/2-p/2,l="https://cdn.safecharge.com/safecharge_resources/v1/websdk/preloader.html?"+(new Date).getTime(),h.apmPopupWindow?(r=h.apmPopupWindow,delete h.apmPopupWindow):"customRedirect"===h.apmWindowType?window.skipGetPaymentStatus=!0:r="newTab"===h.apmWindowType?window.open(l,t):window.open(l,t,"height="+p+",width="+c+",top="+d+",left="+a+",toolbar=yes,location=no,directories=no,status=no,menubar=no,linemenubar=no,scrollbars=yes,resizable=yes,modal=yes"),!r&&void 0===event||!r&&event&&event.isTrusted,window.popupAPM=r,m=function(){_({eventType:"redirectionEnded"});var t=new XMLHttpRequest;t.open("POST",w+"/ppp/api/v1/getPaymentStatus.do",!0),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.timeout=6e4,t.onerror=function(){f({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},t.ontimeout=function(){return f({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},t.onload=function(){var e;200===t.status&&((e=g(JSON.parse(t.response))).paymentOption=e.paymentOption||{},e.paymentOption.card=e.paymentOption.card||{},e={result:e.transactionStatus||e.status,errCode:e.gwExtendedErrorCode||e.gwErrorCode||e.paymentMethodErrorCode||e.errorCode||e.errCode||"0",errorDescription:e.gwErrorReason||e.paymentMethodErrorReason||e.errorDescription||e.reason||"",userPaymentOptionId:e.paymentOption.userPaymentOptionId,ccCardNumber:e.paymentOption.card.ccCardNumber||"",bin:e.paymentOption.card.bin||"",last4Digits:e.paymentOption.card.last4Digits||"",ccExpMonth:e.paymentOption.card.ccExpMonth||"",ccExpYear:e.paymentOption.card.ccExpYear||"",transactionId:e.transactionId,cancelled:!1},s?(s=!1,f(e)):"PENDING"===e.result||"ERROR"===e.result||9072===e.errCode||f(e),o&&"PENDING"===e.result&&(D=setTimeout(m,1e3*i),o--))},t.send(JSON.stringify({sessionToken:h.sessionToken}))}.bind(this),function e(t,n){window.setTimeout(function(){null==t||null==t.closed||1==t.closed?window.skipGetPaymentStatus||n():e(t,n)},200)}(r,m),n(h,f)):h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&e[h.paymentOption.alternativePaymentMethod.paymentMethod]||h.paymentOption&&h.paymentOption.alternativePaymentMethod&&h.paymentOption.alternativePaymentMethod.paymentMethod&&"redirect"===h.apmWindowType||h.paymentOption&&h.paymentOption.card&&h.paymentOption.card.externalToken&&h.paymentOption.card.externalToken.externalTokenProvider&&"GooglePay"!==h.paymentOption.card.externalToken.externalTokenProvider&&"ApplePay"!==h.paymentOption.card.externalToken.externalTokenProvider?(delete h._validationState,n(h,f)):((u=JSON.parse(JSON.stringify(h))).paymentOption=u.paymentOption||{},u.paymentOption.useInitPayment=!0,delete u.shippingAddress,delete u.userDetails,delete u.useDCC,delete u.savePM,delete u._validationState,delete u.clientRequestId,I.blockCards&&0<I.blockCards.length&&u.paymentOption.card&&u.paymentOption.card.cardNumber?v.getCardDetails({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,cardNumber:u.paymentOption.card.cardNumber},function(e){"ERROR"===e.status?f(g(e)):k(O.blockCards,e)?(result={errCode:-6,result:"ERROR",errDescription:"card type blocked"},f(g(result))):v.initPayment(u,function(e){h.paymentOption=h.paymentOption||{};var t=JSON.parse(JSON.stringify(h));t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},delete t.currency,delete t.amount,e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=y,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02","true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=w+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+e.sessionToken),"false"===e.paymentOption.card.threeD.v2supported&&(t.paymentOption.card.threeD={}),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd)),n(t,f)})}):v.initPayment(u,function(e){h.paymentOption=h.paymentOption||{};var t=JSON.parse(JSON.stringify(h));t.paymentOption=t.paymentOption||{},t.paymentOption.card=t.paymentOption.card||{},delete t.currency,delete t.amount,e.paymentOption&&e.paymentOption.card&&e.paymentOption.card.threeD&&(t.paymentOption.card.threeD=t.paymentOption.card.threeD||{},t.paymentOption.card.threeD.v2AdditionalParams=t.paymentOption.card.threeD.v2AdditionalParams||{},t.paymentOption.card.threeD.browserDetails=y,t.paymentOption.card.threeD.v2AdditionalParams.challengeWindowSize="05",t.paymentOption.card.threeD.platformType="02","true"===e.paymentOption.card.threeD.v2supported&&(t.relatedTransactionId=e.transactionId,t.paymentOption.card.threeD.notificationURL=w+"/ppp/api/threeDSecure/completePayment.do?sessionToken="+e.sessionToken),"false"===e.paymentOption.card.threeD.v2supported&&(t.paymentOption.card.threeD={}),e.paymentOption.card.threeD.version&&(t.paymentOption.card.threeD.version=e.paymentOption.card.threeD.version),e.paymentOption.card.threeD.methodCompletionInd&&(t.paymentOption.card.threeD.methodCompletionInd=e.paymentOption.card.threeD.methodCompletionInd)),n(t,f)}))}c=d(h),_({eventType:"initiated"}),!0!==b.isProcessing?(b.isProcessing=!0,I.env&&"int"===I.env.toLocaleLowerCase()?callDtrum("disable"):callDtrum("enable"),h.paymentOption.peers?h.paymentOption.peers.ccCvc?callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_THREE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_ONE_FIELDS"},null]):h.paymentOption.userPaymentOptionId?callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_UPO_PAYMENT"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"WEB_SDK_NOFIELDS"},null]),h.billingAddress&&h.billingAddress.email?(callDtrum("sendSessionProperties",[null,null,{usertokenid:h.billingAddress.email},null]),callDtrum("identifyUser",[h.billingAddress.email+" / "+I.merchantId])):callDtrum("identifyUser",[UUIDjs.create().hex.split("-")[0]+" / "+I.merchantId]),h.sessionToken&&callDtrum("sendSessionProperties",[null,null,{sessiontoken:h.sessionToken},null]),callDtrum("setAutomaticActionDetection",[!1]),v=this,h.openAmount?this.setOpenAmount({sessionToken:I.sessionToken,merchantId:I.merchantId,merchantSiteId:I.merchantSiteId,amount:h.openAmount,currency:h.currency,clientRequestId:h.clientRequestId||Math.ceil(1e16*Math.random()),clientUniqueId:h.clientUniqueId},function(e){"ERROR"===e.status?f(g(e)):t()}):t(),g=function(e){b={};return h&&h.paymentOption&&h.paymentOption.paymentMethod,e.transactionType&&"auth"!==e.transactionType.toLowerCase()&&"sale"!==e.transactionType.toLowerCase()&&(e.transactionStatus="ERROR",e.errCode="-5",e.gwExtendedErrorCode="-5",e.errorDescription="General 3D error",e.result="ERROR"),setTimeout(function(){callDtrum("endSession")},1e3),setTimeout(function(){callDtrum("disable")},2e3),e}):f({processingOrder:!0})},initPayment:function(n,a){var o,e;n.paymentOption.card?((e=JSON.parse(JSON.stringify(n))).paymentOption.card.cardNumber="**** **** **** ****",e.paymentOption.card.expirationMonth="**",e.paymentOption.card.expirationYear="**",e.paymentOption.card.CVV="***",g.info("---\x3e initPayment input object\n"+JSON.stringify(e,null,4))):g.info("---\x3e initPayment input object\n"+JSON.stringify(n,null,4)),g.trace("---\x3e TRACE initPayment \n"),n.paymentOption&&n.paymentOption.__tokenize?n.paymentOption.__tokenize(I,n,function(e){a(e)}):n&&n.paymentOption&&(o=new XMLHttpRequest,e=w+"/ppp/api/v1/cardTokenization.do",(n.paymentOption.userPaymentOptionId||n.paymentOption.useInitPayment)&&(e=w+"/ppp/api/v1/websdk/initPaymentWithCardTokenization.do"),o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.timeout=6e4,o.onload=function(){if(callDtrum("leaveAction",[window.initPaymentId,Date.now()]),200!==o.status)return a(JSON.parse(o.responseText));var t=N(o.responseText);if("ERROR"===t.status)return t.error={type:"card",code:t.errCode},t.error.message=t.reason||"Process failed.",a(t);if("SUCCESS"!==t.status)return a(t);var e="";if(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.version&&(e=t.paymentOption.card.threeD.version),P=t.paymentOption.card.threeD.v2supported,_({eventType:"tokenized",threeD:{version:e}}),t.transactionStatus&&(n.transactionStatus=t.transactionStatus),t.transactionType&&(n.transactionType=t.transactionType),t.transactionId&&(n.transactionId=t.transactionId),!(t.paymentOption&&t.paymentOption.card&&t.paymentOption.card.threeD&&t.paymentOption.card.threeD.v2supported&&"true"===t.paymentOption.card.threeD.v2supported))return a(t);e=t.paymentOption.card.threeD;if(n.paymentOption=t.paymentOption||{},n.paymentOption.card=t.paymentOption.card||{},n.paymentOption.card.threeD=t.paymentOption.card.threeD||{},!e.methodUrl)return n.paymentOption.card.threeD.methodCompletionInd="U",a(n);e.methodUrl&&e.methodPayload&&R(e.methodUrl,e.methodPayload,function(e){return t.paymentOption.card.threeD.methodCompletionInd=e,a(t)})},o.ontimeout=function(){return callDtrum("leaveAction",[window.initPaymentId,Date.now()]),a({error:{type:"network",code:"connection_timeout",message:"Connection to Safecharge server timed out."}})},o.onerror=function(){callDtrum("leaveAction",[window.initPaymentId,Date.now()]);a({status:"ERROR",type:"network",code:"connection_timeout",errorDescription:"Connection to Safecharge server timed out."})},n.sourceApplication=I.sourceApplication||"WEB_SDK",e=callDtrum("enterAction",["initPayment_started/initPayment_complete",void 0,Date.now()]),window.initPaymentId=e,o.send(JSON.stringify(n)))},paymentFrame:A,getToken:function(e,t){I.env&&"int"===I.env.toLocaleLowerCase()?callDtrum("disable"):callDtrum("enable");var n=e;return t&&t.billingAddress&&t.billingAddress.email?(callDtrum("sendSessionProperties",[null,null,{usertokenid:t.billingAddress.email},null]),callDtrum("identifyUser",[t.billingAddress.email+" / "+I.merchantId])):callDtrum("identifyUser",[UUIDjs.create().hex.split("-")[0]+" / "+I.merchantId]),e.peers.ccCvc?callDtrum("sendSessionProperties",[null,null,{fieldstype:"getToken_THREE_FIELDS"},null]):callDtrum("sendSessionProperties",[null,null,{fieldstype:"getToken_ONE_FIELDS"},null]),g.trace("---\x3e TRACE sfc.getToken() \n"),{then:function(e){if(t&&t.sessionToken&&(I.sessionToken=t.sessionToken),t&&t.merchantSiteId&&(I.merchantSiteId=t.merchantSiteId),!I.merchantSiteId)throw new Error("Merchant site id is mandatory.");if(!I.sessionToken)throw new Error("Session token is mandatory.");n.__tokenize(I,t,e)}}},setOpenAmount:function(e,t){e.sessionToken=e.sessionToken||I.sessionToken,e.merchantId=e.merchantId||I.merchantId,e.merchantSiteId=e.merchantSiteId||I.merchantSiteId,setOrderAmount(w,e,t)}}},e.SafeCharge.removeEvents=function(){window.removeEventListener("message",l,!1)},e.websdk=e.SafeCharge}(window);